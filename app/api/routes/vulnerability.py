from typing import List
from fastapi import APIRouter, Path, Depends, HTTPException
from sqlalchemy.orm import Session
from app.api import deps
from app.crud.upload_survey import upload_survey as survey
from app.crud.kerentanan import VulnerabilityService
from app.schemas.kerentanan import Kerentanan


router = APIRouter()
service = VulnerabilityService()


@router.get('/vulnerability', response_model=List[Kerentanan])
def get_all_kerentanan(db: Session = Depends(deps.get_db)):
    return VulnerabilityService().get_all(db)


@router.get('/vulnerability/id={kelurahan_id}', response_model=dict)
def get_kerentanan_by_id(kelurahan_id: int, db: Session = Depends(deps.get_db)):
    kerentanan = service.get_by_kelurahan_id(db, kelurahan_id)
    if not kerentanan:
        raise HTTPException(status_code=404, detail="Kerentanan not found")

    return {
        "id": kerentanan.id,
        "kategori_kerentanan": kerentanan.kategori_kerentanan
    }
